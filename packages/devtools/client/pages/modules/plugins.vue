<script setup lang="ts">
import type { PluginInfoWithMetic } from '@nuxt/devtools-kit/types'

definePageMeta({
  icon: 'carbon-plug',
  title: 'Plugins',
  category: 'analyze',
})

const config = useServerConfig()
const client = useClient()

const plugins = computed((): PluginInfoWithMetic[] => {
  const plugins = config.value?.plugins || []
  const metics = client.value.getClientPluginMetrics()

  return plugins.map((plugin) => {
    const p = typeof plugin === 'string' ? { src: plugin } : plugin
    return {
      ...p,
      metric: metics.find(m => m.src === p.src || m.src.startsWith(p.src)),
    }
  })
})
</script>

<template>
  <NSectionBlock
    v-if="config"
    icon="carbon-plug"
    text="Plugins"
    :description="`Total plugins: ${config.plugins.length}`"
  >
    <div pt4>
      <PluginItem
        v-for="plugin, idx of plugins"
        :key="plugin.src"
        :plugin="plugin"
        :index="idx + 1"
        ml--4 border-base py2 :class="idx ? 'border-t' : ''"
      />
    </div>
  </NSectionBlock>

  <HelpFab path="/plugins" />
</template>
